<div id="result">요청중...</div>
<script>
const raw = decodeURIComponent(location.pathname.substring(1));
function extractURL(str) {
  try {
    return JSON.parse(str).URL;
  } catch {
    return null;
  }
}
async function generate() {
  if(raw.endsWith('-')) {
    if (raw.length < 2 || raw.length > 11) return alert("1~10자 사이로 입력해주세요.");
    const url = `https://g.keddie213.workers.dev/shorten?u=${encodeURIComponent(raw.replace(/-+$/, ''))}`;
    try {
      const res = await fetch(url);
      const text = await res.text();

      document.getElementById("result").innerHTML = `단축 URL은 <a href="#" onclick="navigator.clipboard.writeText(this.innerText)">${decodeURIComponent(window.location.href).replace(/-+$/, '')}</a> 입니다.\n단축 URL은 ${extractURL(text)} 으로 연결됩니다.`; 
    } catch(e) {
        document.getElementById("result").innerText = "요청 실패 에러" + e;
    }
    return;
  }
  if (raw.length < 1 || raw.length > 10) return alert("1~10자 사이로 입력해주세요.");
  const url = `https://g.keddie213.workers.dev/shorten?u=${encodeURIComponent(raw)}`;
  try {
    const res = await fetch(url);
    const text = await res.text();

    document.getElementById("result").innerText = 
        `${text}`;
    if(extractURL(text) != null) {
      window.location = extractURL(text);
    }
  } catch(e) {
    document.getElementById("result").innerText = "요청 실패 에러" + e;
  }
}
window.onload = () => {
  generate();
};
</script>